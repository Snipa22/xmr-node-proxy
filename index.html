<!DOCTYPE html>
<html>
	<head>
		<title>XNP Hashrate Monitor</title>
		<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
	</head>
	<body>
		<table id="displaytable" width="100%"><table>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
		<script>
(($) => {

var $disp = $('#displaytable').DataTable({
	ajax: {
		url: "/json",
		type: "GET",
		dataSrc: parseJSON
	},
	columns: [
		{ title: "Name", data: "name", className: "dt-body-right" },
		{ title: "Hashrate", data: "hashrate" }
	]
})
setInterval(() => { $disp.ajax.reload(); }, 15000);

function parseJSON(json) {
	var res = [];
	var worker, miner, name;
	for(var workerid in json) {
		worker = json[workerid];
		if(worker.length == 0) continue;
		for(var minerid in worker) {
			miner = worker[minerid];
			if(miner.length == 0) continue;
			name = (miner["password"].length > 0) ? miner["password"] : miner["id"];
			row = { name: name, hashrate: miner["avgSpeed"] }
			res.push(row);
		}
	}
	return res;
}

})(jQuery)
		</script>
	</body>
</html>
